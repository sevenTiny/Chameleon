@using Chameleon.Entity;
@using Chameleon.Infrastructure.Consts;
@using Chameleon.Infrastructure.Configs;
@{
    ViewData["Title"] = "Home";
    Layout = "~/Views/Shared/_LayoutHeaderStyle.cshtml";

    var apiHost = UrlsConfig.Instance.DataApi;
}
<link href="~/lib/avatar/avatar.css" rel="stylesheet" />

<header class="navbar-wrapper">
    <div class="navbar navbar-fixed-top">
        <div class="container-fluid cl">
            <a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
            <nav class="nav navbar-nav">
                <ul class="cl">
                    <li><a href="#" class="dropDown_A">企业后台管理系统 </a></li>
                    <li class="navbar-levelone current"></li>
                </ul>
            </nav>
            <nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
                <ul class="cl">
                    <li>欢迎您，@ViewData["UserRole"] &nbsp;</li>
                    <li class="dropDown dropDown_hover">
                        <img class="avatar size-S radius" src="~/chameleon.png">
                        <a href="#" class="dropDown_A"> @ViewData["UserName"] <i class="Hui-iconfont">&#xe6d5;</i></a>
                        <ul class="dropDown-menu menu radius box-shadow">
                            <li><a href="@UrlsConfig.Instance.Office" target="_blank">前台首页</a></li>
                            <li><a href="javascript:myinfo()">个人信息</a></li>
                            <li><a href="@AccountConst.SwitchAccountAccountUrl">切换账户</a></li>
                            <li><a href="@AccountConst.SignOutAccountUrl">退出</a></li>
                        </ul>
                    </li>
                    <li id="Hui-msg"> <a target="_blank" href="/ChameleonMessage/UnReadMessageList" title="消息"><span style="display:none" class="badge badge-danger" id="chameleonMessageCount">0</span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> </li>
                    <li id="Hui-skin" class="dropDown right dropDown_hover">
                        <a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size:18px">&#xe62a;</i></a>
                        <ul class="dropDown-menu menu radius box-shadow">
                            <li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
                            <li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
                            <li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
                            <li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
                            <li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
                            <li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<aside class="Hui-aside">
    <div class="menu_dropdown bk_1">
        <dl id="menu-article">
            <dt title="用户管理"><i class="Hui-iconfont">&#xe60d;</i> 用户管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
            <dd>
                <ul>
                    <li><a href="javascript:mainFrameOpen('/UserAccount/List')"><i class="Hui-iconfont">&#xe611;</i> 用户列表</a></li>
                </ul>
            </dd>
        </dl>
        <dl id="menu-article">
            <dt title="组织管理"><i class="Hui-iconfont">&#xe643;</i> 组织管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i></dt>
            <dd>
                <ul>
                    <li><a href="javascript:mainFrameOpen('/Organization/Setting')"><i class="Hui-iconfont">&#xe63c;</i> 组织设置</a></li>
                    <li><a href="javascript:mainFrameOpen('/Organization/DisableList')"><i class="Hui-iconfont">&#xe631;</i> 停用的组织</a></li>
                </ul>
            </dd>
        </dl>
    </div>
</aside>
<div class="dislpayArrow hidden-xs"><a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a></div>

<section class="Hui-article-box">
    <article class="cl pd-20">
        <div class="show_iframe" style="margin-bottom:50px;">
            <div style="display:none" class="loading"></div>
            <iframe id="main_iframe" scrolling="auto" frameborder="0" src="/Home/Abount"></iframe>
        </div>
    </article>
</section>

@await Html.PartialAsync($"~/Views/Shared/_FooterScripts.cshtml")
@await Html.PartialAsync($"~/Views/Shared/_CommonScript.cshtml")
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript">
    //头部控件切换
    $(function () {
        $("body").Huitab({
            tabBar: ".navbar-wrapper .navbar-levelone",
            tabCon: ".Hui-aside .menu_dropdown",
            className: "current",
            index: 0,
        });
    });

    getMessageCount()

    setInterval(getMessageCount, 30000);

    function getMessageCount() {
         $.ajax({
            type: 'GET',
            url: '@apiHost/api/CloudData?_interface=ChameleonMessage.MessageAlert.CurrentUserUnReadMessageCount',
            dataType: 'json',
            data: {
            },
            success: function (data) {
                if (data.success) {
                    var count = data.data
                    if (count > 0) {
                        $("#chameleonMessageCount").show();
                        $("#chameleonMessageCount").html(data.data)
                    } else {
                        $("#chameleonMessageCount").hide();
                    }
                }
            },
            error: function (data) {
                $("#chameleonMessageCount").hide();
                console.log(data.msg);
            },
     });
    }

    //在frame中打开页面
    function mainFrameOpen(url) {
        $("#main_iframe").prop("src", url);
    }

    function myinfo() {
        layer_open('个人信息','/UserAccount/UserAccountInfo?userId=@ViewData["UserId"]',0.7)
    }
</script>
<!--/请在上方写此页面业务相关的脚本-->